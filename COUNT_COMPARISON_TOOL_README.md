# 检测数量对比工具使用说明

## 功能简介

这个工具通过比较真实标签和预测标签txt文件的行数来评估检测数量准确性，使用公式：`1 - |pred_count - true_count| / true_count`

## 使用方法

### 1. 修改路径
打开 `count_comparison_tool.py` 文件，修改以下两个路径：

```python
# 真实标签目录路径
true_labels_dir = "/home/cjh/mmdetection/data/balloon/yolo_format/labels/val"

# 预测标签目录路径  
pred_labels_dir = "/home/cjh/ultralytics/runs/inference/balloon_yolo11x_20251022_211601_val/predict/labels"
```

### 2. 运行工具
```bash
python count_comparison_tool.py
```

## 输出说明

### 1. 文件名一致性检查
- 显示两个目录中的文件数量
- 检查共同文件、仅在真实标签中的文件、仅在预测标签中的文件
- 提示文件名是否完全一致

### 2. 检测数量统计
- 总体统计：处理文件数、总检测数、平均检测数
- Metric值统计：平均值、范围、分类统计
- 准确度最高和最低的5个文件

### 3. Metric值含义
- **1.0**: 完美匹配（预测数量 = 真实数量）
- **0.8**: 良好预测（误差在20%以内）
- **0.0**: 预测误差 = 100%
- **负值**: 预测误差 > 100%（严重过检测）

## 示例输出

```
🔬 检测数量对比工具
通过比较txt文件行数评估检测数量准确性
============================================================
📂 真实标签目录: /home/cjh/mmdetection/data/balloon/yolo_format/labels/val
📂 预测标签目录: /home/cjh/ultralytics/runs/inference/balloon_yolo11x_20251022_211601_val/predict/labels

🔍 检查文件名一致性...
==================================================
📂 真实标签: 13 个文件
📂 预测标签: 13 个文件

📊 比较结果:
   共同文件: 13
   仅在真实标签中: 0
   仅在预测标签中: 0

✅ 文件名完全一致！

📊 计算检测数量准确性...
==================================================
🔢 计算 13 个文件的检测数量...

📈 总体统计:
   处理文件数: 13
   有效文件数: 13
   总真实检测数: 50
   总预测检测数: 145
   平均每文件真实检测数: 3.85
   平均每文件预测检测数: 11.15

🎯 Metric值统计:
   平均Metric值: -2.8242
   Metric范围: [-9.0000, 0.5714]
   完美匹配: 0 个 (0.0%)
   良好预测: 0 个 (0.0%)
   较差预测: 11 个 (84.6%)

🏆 准确度最高的5个文件:
   1. 16335852991_f55de7958d_k.txt: 真实=7, 预测=10, Metric=0.5714
   2. 8053085540_a72bd21a64_k.txt: 真实=6, 预测=10, Metric=0.3333
   ...

⚠️  准确度最低的5个文件:
   1. 24631331976_defa3bb61f_k.txt: 真实=1, 预测=3, Metric=-1.0000
   2. 6810773040_3d81036d05_k.txt: 真实=4, 预测=10, Metric=-0.5000
   ...

🎉 分析完成!
```

## 注意事项

1. **路径检查**: 确保两个目录路径都正确
2. **文件格式**: 确保txt文件格式正确（每行一个检测框）
3. **文件名匹配**: 工具会自动检查文件名是否一致
4. **编码问题**: 如果遇到编码问题，可能需要调整文件读取方式

## 自定义修改

如果需要修改metric公式或其他逻辑，可以修改 `calculate_accuracy` 函数中的相关部分。
